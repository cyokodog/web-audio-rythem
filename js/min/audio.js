var Audio=function(e,t){var n=this,o=n.config=n._extend({},Audio.defauts,t);o.context=e,o.gain=o.context.createGain(),o.convolver=o.context.createConvolver(),o.gain.connect(o.convolver),o.convolver.connect(o.context.destination),n.setParam()};Audio.prototype={_extend:function(){for(var e=arguments[0],t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)e[o]=n[o]}return e},setParam:function(e){var t=this.config.effectSoundId,n=this,o=n.config=n._extend(n.config,e||{});o.audioBuffers&&o.effectSoundId!=t&&(o.convolver.buffer=o.audioBuffers[o.effectSoundId])},playScore:function(){var e=this,t=e.config,n=t.context.currentTime,o=0;t.isPlaying=!0,t.bufferSources=[];var r=function(){for(var e=0;e<t.beat;e++)t.score.forEach(function(r){if(r.pattern[e]){var c=t.context.createBufferSource();c.buffer=t.audioBuffers[r.soundId],c.connect(t.gain),c.start(.1+n+(e+o*t.beat)/4*(60/t.tempo)),t.bufferSources.push(c),c.onended=function(){t.bufferSources.shift()}}});o++},c=function(){t.timer=setTimeout(function(){t.context.currentTime-n>=o*t.beat/4*(60/t.tempo)&&r(),c()},0)};c()},stopScore:function(){var e=this,t=e.config;t.isPlaying&&(t.isPlaying=!1,t.bufferSources.forEach(function(e){e.stop()}),t.bufferSources=[],clearTimeout(t.timer))}},Audio.defauts={beat:16,tempo:80};